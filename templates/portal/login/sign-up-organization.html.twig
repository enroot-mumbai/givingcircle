{% extends 'portal/layout/index.html.twig' %}
{% block portal_content %}
    {% set cmsPageContent = get_cms_page_content_by_slugname('sign-up') %}
    <div class="wrapper login-container login-other">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav aria-label="breadcrumb" data-aos="fade-right" data-aos-delay="500"
                         class="breadcrumb d-flex justify-content-end">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{{ path('homepage') }}"><i class="fa fc-home"></i></a></li>
                            <li class="breadcrumb-item active" aria-current="page">Register</li>
                        </ol>
                    </nav>
                </div>
                <div class="col-lg-7 col-md-10 col-12 mx-auto">
                    <div class="signup-form">
                        <div class="text-center">
                            <div class="login-head"><img src="../resources/images/common/icons/icon-building.png"></div>
                            {{ cmsPageContent.cmsPageContent[3].pageContent|raw }}
                            <p>All fields are mandatory.</p>
                        </div>
                        {{ form_start(form) }}
                            <div class="row row-sm">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Organization Name</label>
                                        {{ form_widget(form.trnOrganizationDetails.vars.prototype.organizationName) }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Types of Organization</label>
                                        <div class="cust-select">
                                            {{ form_widget(form.trnOrganizationDetails.vars.prototype.mstTypeOfOrganization) }}
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="row row-sm">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label class="">Title</label>
                                                <div class="cust-select">
                                                    {{ form_widget(form.appUserInfo.mstSalutation) }}
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-md-9">
                                            <div class="form-group">
                                                <label class="">First Name</label>
                                                {{ form_widget(form.appUserInfo.userFirstName) }}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Last Name</label>
                                        {{ form_widget(form.appUserInfo.userLastName) }}
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="">Country</label>
                                        <div class="cust-select">
                                            {{ form_widget(form.appUserInfo.mstCountry) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="">State</label>
                                        <div class="cust-select">
                                            {{ form_widget(form.appUserInfo.mstState) }}
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="">City</label>
                                        <div class="cust-select">
                                            {{ form_widget(form.appUserInfo.mstCity) }}
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">

                                    <div class="form-group mob-number">
                                        <label>Mobile Number</label>
                                        <div class="input-group-prepend">
                                            <div class="cust-select">
                                                <select class="form-control">
                                                    <option>+91</option>
                                                </select>
                                                <div style="display: none;">{{ form_widget(form.appUserInfo
                                                        .mobileCountryCode)
                                                    }}</div>

                                            </div>
                                        </div>
                                        {{ form_widget(form.appUserInfo.userMobileNumber) }}
                                        <div class="tooltip thm2">
                                            <span class="tooltiptext">
                                                <ul>
                                                    <li>Your Mobile number is outside India.</li>
                                                    <li>Your mobile verification is through email id.</li>
                                                </ul>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Email ID</label>
                                        {{ form_widget(form.appUserInfo.userEmail) }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group password_input">
                                        <label>Password</label>
                                        {{ form_widget(form.UserPassword) }}
                                        <span toggle="#app_user_org_portal_registration_UserPassword"
                                              class="fa fa-fw fa-eye-slash field-icon toggle-password"></span>
                                    </div>
                                    <ul class="password-strength">
                                        <li class=""><span class="eight-character"><i class="fa fa-times"
                                                                                      aria-hidden="true"></i></span>&nbsp; At least 8 Character</li>
                                        <li class=""><span class="one-number"><i class="fa fa-times"
                                                                                 aria-hidden="true"></i></span> &nbsp;Minimum 1 number</li>
                                        <!-- <li class=""><span class="low-upper-case"><i class="fa fa-times" aria-hidden="true"></i></span>&nbsp; 1 lowercase &amp; 1 uppercase</li> -->
                                        <li class=""><span class="one-special-char"><i class="fa fa-times"
                                                                                       aria-hidden="true"></i></span> &nbsp;Minimum 1 Special Character
                                        </li>

                                    </ul>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group text-center">
                                        <button type="submit" class="btn btn-primary btn-next" id="submit-individual-sign-up">
                                            Next
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-3" style="display: none;">
                                {{ form_row(form.userName) }}
                            </div>
                        {{ form_end(form) }}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        $(document).ready(function () {
            $("body").addClass("login-page");
            $("[name='app_user_org_portal_registration']").addClass("form");

            jQuery("#app_user_org_portal_registration_appUserInfo_mstCountry").change(function () {

                changeSelectLabel(jQuery(this));

                var data = {};
                data['q'] = jQuery(this).val();
                jQuery.ajax({
                    url: "/portal/location/state_list",
                    data: data,
                    type: "GET",
                    dataType: "JSON",
                    success: function (data) {
                        var product = $("#app_user_org_portal_registration_appUserInfo_mstState");
                        product.html('');
                        product.append('<option value="" ></option>');
                        // add options
                        $.each(data, function (id, name) {
                            product.append('<option value="'+ name.id +'">'+ name.name + '</option>');
                        });
                    }
                });
            });
            jQuery("#app_user_org_portal_registration_appUserInfo_mstState").change(function () {

                changeSelectLabel(jQuery(this));

                var data = {};
                data['q'] = jQuery(this).val();
                jQuery.ajax({
                    url: "/portal/location/city_list",
                    data: data,
                    type: "GET",
                    dataType: "JSON",
                    success: function (data) {
                        var product = $("#app_user_org_portal_registration_appUserInfo_mstCity");
                        product.html('');
                        product.append('<option value="" ></option>');
                        $.each(data, function (id, name) {
                            product.append('<option value="'+ name.id +'">'+ name.name + '</option>');
                        });
                    }
                });
            });

            $("#app_user_org_portal_registration_trnOrganizationDetails___name___mstTypeOfOrganization").change(function () {
                changeSelectLabel($(this));
            });

            // change label of city
            $("#app_user_org_portal_registration_appUserInfo_mstCity").change(function () {
                changeSelectLabel($(this));
            });
            //change label of title
            $("#app_user_org_portal_registration_appUserInfo_mstSalutation").change(function () {
                changeSelectLabel($(this));
            });

            // Set default country as India
            $("#app_user_org_portal_registration_appUserInfo_mstCountry option").filter(function() {
                if($(this).text() == 'India') {
                    $(this).attr('selected', true);
                }
            });
            $("#app_user_org_portal_registration_appUserInfo_mstCountry").change();

            $(".toggle-password").click(function () {
                $(this).toggleClass("fa-eye-slash fa-eye");
                var input = $($(this).attr("toggle"));
                if (input.attr("type") == "password") {
                    input.attr("type", "text");
                } else {
                    input.attr("type", "password");
                }
            });
            $('#app_user_org_portal_registration_UserPassword').keyup(function () {
                var password = $('#app_user_org_portal_registration_UserPassword').val();
                if (checkStrength(password) == false) {
                    $('#sign-up').attr('disabled', true);
                }
            });

            function checkStrength(password) {
                var strength = 0;


                //If password contains both lower and uppercase characters, increase strength value.
                if (password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)) {
                    strength += 1;
                    $('.low-upper-case').addClass('text-success');
                    $('.low-upper-case i').removeClass('fa-times').addClass('fa-check');
                    $('#popover-password-top').addClass('hide');


                } else {
                    $('.low-upper-case').removeClass('text-success');
                    $('.low-upper-case i').addClass('fa-times').removeClass('fa-check');
                    $('#popover-password-top').removeClass('hide');
                }

                //If it has numbers and characters, increase strength value.
                if (password.match(/([a-zA-Z])/) && password.match(/([0-9])/)) {
                    strength += 1;
                    $('.one-number').addClass('text-success');
                    $('.one-number i').removeClass('fa-times').addClass('fa-check');
                    $('#popover-password-top').addClass('hide');

                } else {
                    $('.one-number').removeClass('text-success');
                    $('.one-number i').addClass('fa-times').removeClass('fa-check');
                    $('#popover-password-top').removeClass('hide');
                }

                //If it has one special character, increase strength value.
                if (password.match(/([!,%,&,@,#,$,^,*,?,_,~])/)) {
                    strength += 1;
                    $('.one-special-char').addClass('text-success');
                    $('.one-special-char i').removeClass('fa-times').addClass('fa-check');
                    $('#popover-password-top').addClass('hide');

                } else {
                    $('.one-special-char').removeClass('text-success');
                    $('.one-special-char i').addClass('fa-times').removeClass('fa-check');
                    $('#popover-password-top').removeClass('hide');
                }

                if (password.length > 7) {
                    strength += 1;
                    $('.eight-character').addClass('text-success');
                    $('.eight-character i').removeClass('fa-times').addClass('fa-check');
                    $('#popover-password-top').addClass('hide');

                } else {
                    $('.eight-character').removeClass('text-success');
                    $('.eight-character i').addClass('fa-times').removeClass('fa-check');
                    $('#popover-password-top').removeClass('hide');
                }
            }
            jQuery("#app_user_org_portal_registration_appUserInfo_userMobileNumber").change(function () {
                checkIsMobileNumberUnique();
            });

            $('#app_user_org_portal_registration_appUserInfo_mobileCountryCode').change(function () {
                console.log($(this).val());
                if ($.trim($(this).val()) != 91 ) {
                    $('.tooltiptext').show();
                }
                else {
                    $('.tooltiptext').hide();
                }
                checkIsMobileNumberUnique();
            });
            function validateEmail($email) {
                var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
                return emailReg.test( $email );
            }
            $('#app_user_org_portal_registration_appUserInfo_userEmail').change(function () {
                if( !validateEmail(jQuery(this).val())) {
                    alert("Please enter a valid email address.");
                    $("#app_user_org_portal_registration_userName").val('');
                    $("#app_user_org_portal_registration_appUserInfo_userEmail").val('');
                    $("#app_user_org_portal_registration_appUserInfo_userEmail").focus();
                    return false;
                }
                var data = {};
                emailID = data['q'] = $.trim(jQuery(this).val());
                jQuery.ajax({
                    url: "/portal/user_email/check_unqiue",
                    data: data,
                    type: "GET",
                    dataType: "JSON",
                    success: function (data) {
                        if(data.unique == true) {
                            $("#app_user_org_portal_registration_userName").val(emailID);
                        } else {
                            alert("User already exist with specified email address.");
                            $("#app_user_org_portal_registration_userName").val('');
                            $("#app_user_org_portal_registration_appUserInfo_userEmail").val('');
                        }
                    }
                });
            });

            function formcontrol(){
                $(".form-control").filter(function() {
                    if (this.value.length !==0){
                        $(this).siblings('label').addClass('clicked');
                    }
                });
            }

            formcontrol();
            $('.form-group label').click(function () {
                $(this).addClass('clicked');
            });
            $('.form-control').click(function () {
                $(this).siblings('label').addClass('clicked');
            });
            $('.form-control').keyup(function () {
                $(this).siblings('label').addClass('clicked');
            });
            $('.form-control').blur(function () {
                if ($(this).val()) {
                    $(this).siblings('label').addClass('clicked');
                } else if (!$(this).val()) {
                    $(this).siblings('label').removeClass('clicked');
                }
            });
            $('.form-control:-webkit-autofill').each(function(){
                $(this).siblings('label').addClass('clicked');
            });

            $('.form-control select').change(function () {
                changeSelectLabel($(this));
            });
        });

        function changeSelectLabel(elem) {

            if ($(elem).val().length !== 0) {
                $(elem).parent().parent().find('label').addClass('clicked');
            } else {
                $(elem).parent().parent().find('label').removeClass('clicked');
            }
        }

        function checkIsMobileNumberUnique(){
            var data = {};
            mobileNo = data['mobileNo'] = $.trim(jQuery("#app_user_org_portal_registration_appUserInfo_userMobileNumber").val
            ());
            if ($.isNumeric(mobileNo) == false) {
                alert("Please enter valid mobile Number.");
                $("#app_user_org_portal_registration_appUserInfo_userMobileNumber").val('');
                return false;
            }

            if (mobileNo.length != 10) {
                alert("Please enter valid mobile Number.");
                $("#app_user_org_portal_registration_appUserInfo_userMobileNumber").val('');
                return false;
            }

            countryCode = data['countryCode'] = '91';
            //countryCode = data['countryCode'] = $.trim(jQuery
            //("#app_user_org_portal_registration_appUserInfo_mobileCountryCode").val());
            jQuery.ajax({
                url: "/portal/user_mob/check_unique",
                data: data,
                type: "GET",
                dataType: "JSON",
                success: function (data) {
                    if(data.unique == false) {
                        alert("User already exist with specified mobile number.");
                        $("#app_user_org_portal_registration_appUserInfo_userMobileNumber").val('');
                    }
                }
            });
        }
    </script>
{% endblock %}